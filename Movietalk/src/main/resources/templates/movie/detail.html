<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>영화 상세</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .overview-wrapper {
            max-width: 90%;
            margin-right: auto;
        }
    </style>
</head>
<body>

<!-- 🧭 네비게이션 바 -->
<div th:replace="~{fragments/top-nav :: topNav}"></div>

<!-- ✅ 성인 콘텐츠 제한 메시지 -->
<div th:if="${adultRestricted}" class="text-center mt-5">
    <h3 class="text-danger">성인 콘텐츠로 인해 상세 정보를 표시할 수 없습니다.</h3>
    <a th:href="@{/movies}" class="btn btn-secondary mt-4">목록으로 돌아가기</a>
</div>

<!-- ✅ 일반 상세 정보 출력 -->
<div th:unless="${adultRestricted}" class="mt-4">
    <!-- 🎬 영화 제목 -->
    <h2 class="text-center mb-5"
        th:text="${movie != null} ? ${movie.title} : ${detail.title}">제목</h2>

    <div class="row">
        <!-- 🎞 포스터 -->
        <div class="col-md-4 text-center mb-4">
            <img th:src="${movie != null} ? ${movie.posterUrl} : 'https://image.tmdb.org/t/p/w500' + ${detail.posterPath}"
                 alt="포스터" class="img-fluid rounded shadow" style="max-width: 70%;">
        </div>

        <!-- 📋 상세 정보 -->
        <div class="col-md-8">
            <p><strong>개봉일:</strong>
                <span th:text="${movie != null} ? ${movie.releaseDate} : ${detail.releaseDate}">
                    2024-05-01
                </span>
            </p>

            <p><strong>장르:</strong>
                <span th:each="genre : ${detail.genres}"
                      th:text="${genre.name}"
                      th:append=", "
                      th:remove="tag"></span>
            </p>

            <p><strong>국가:</strong>
                <span th:each="country : ${detail.productionCountries}"
                      th:text="${country.name}"
                      th:append=", "
                      th:remove="tag"></span>
            </p>

            <p><strong>러닝타임:</strong>
                <span th:text="${detail.runtime} + '분'">120분</span>
            </p>

            <!-- ✏️ 줄거리 -->
            <hr>
            <div class="mt-4 overview-wrapper">
                <h5>줄거리</h5>
                <p th:text="${detail.overview != null && !#strings.isEmpty(detail.overview)
                    ? detail.overview : '줄거리 정보가 없습니다.'}"></p>
            </div>

            <!-- 🎭 출연진 정보 (줄거리 바로 아래로 이동) -->
            <div class="mt-4">
                <h5 class="mb-2">출연진</h5>
                <p>
                    <span th:each="actor, iterStat : ${#lists.size(detail.cast) > 5 ? detail.cast.subList(0,5) : detail.cast}">
                        <span th:text="${actor.name + '(' + actor.character + '역)'}"></span>
                        <span th:if="${!iterStat.last}">, </span>
                    </span>
                </p>
            </div>
        </div>
    </div>

    <!-- 🔘 버튼 영역 -->
    <div class="d-flex justify-content-center mt-5 mb-5 gap-3">
        <a th:if="${detail != null}"
           th:href="@{/reviews/new(movieId=${movie != null ? movie.movieId : detail.tmdbId})}"
           class="btn btn-primary">리뷰 작성하기</a>

        <a th:href="@{/movies}" class="btn btn-secondary">목록으로 돌아가기</a>
    </div>
</div>

</body>
</html>
