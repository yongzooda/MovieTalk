<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì˜í™” ìƒì„¸</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            padding-bottom: 60px;
        }

        .layout-container {
            margin: 0 auto;
            max-width: 1080px;
            padding: 0 15px;
        }

        .detail-layout {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            align-items: flex-start;
            margin-bottom: 2rem;
        }

        .poster-box {
            flex: 0 0 280px;
        }

        .info-box {
            flex: 1;
            max-width: calc(100% - 310px);
        }

        .overview-wrapper {
            max-width: 100%;
        }

        .button-group-container {
            margin-top: 1rem;
            padding: 0 15px;
        }
    </style>
</head>
<body>

<!-- ğŸ§­ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<div th:replace="~{fragments/top-nav :: topNav}"></div>

<!-- âœ… ì„±ì¸ ì½˜í…ì¸  ì œí•œ ë©”ì‹œì§€ -->
<div th:if="${adultRestricted}" class="text-center mt-5">
    <h3 class="text-danger">ì„±ì¸ ì½˜í…ì¸ ë¡œ ì¸í•´ ìƒì„¸ ì •ë³´ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</h3>
    <a th:href="@{/movies}" class="btn btn-secondary mt-4">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
</div>

<!-- âœ… ì¼ë°˜ ìƒì„¸ ì •ë³´ ì¶œë ¥ -->
<div th:unless="${adultRestricted}" class="mt-4 layout-container">

    <!-- ğŸ¬ ì˜í™” ì œëª© -->
    <h2 class="text-center mb-5"
        th:text="${movie != null} ? ${movie.title} : ${detail.title}">ì œëª©</h2>

    <!-- ğŸ“ ì½˜í…ì¸  ë³¸ë¬¸ -->
    <div class="detail-layout">
        <!-- ğŸ í¬ìŠ¤í„° -->
        <div class="poster-box text-center">
            <img th:src="${movie != null} ? ${movie.posterUrl} : 'https://image.tmdb.org/t/p/w500' + ${detail.posterPath}"
                 alt="í¬ìŠ¤í„°" class="img-fluid rounded shadow" style="max-width: 100%;">
        </div>

        <!-- ğŸ“‹ ìƒì„¸ ì •ë³´ -->
        <div class="info-box">
            <p><strong>ê°œë´‰ì¼:</strong>
                <span th:text="${movie != null} ? ${movie.releaseDate} : ${detail.releaseDate}">2024-05-01</span>
            </p>

            <th:block th:with="genreNames=${detail.genres.?[name != null].![name]}">
                <p><strong>ì¥ë¥´:</strong>
                    <span th:text="${#strings.listJoin(genreNames, ' / ')}"></span>
                </p>
            </th:block>

            <th:block th:with="countryNames=${detail.productionCountries.?[name != null].![name]}">
                <p><strong>êµ­ê°€:</strong>
                    <span th:text="${#strings.listJoin(countryNames, ' / ')}"></span>
                </p>
            </th:block>

            <p><strong>ëŸ¬ë‹íƒ€ì„:</strong>
                <span th:text="${detail.runtime} + 'ë¶„'">120ë¶„</span>
            </p>

            <hr>

            <!-- âœï¸ ì¤„ê±°ë¦¬ -->
            <div class="mt-4 overview-wrapper">
                <h5>ì¤„ê±°ë¦¬</h5>
                <p th:text="${detail.overview != null && !#strings.isEmpty(detail.overview)
                    ? detail.overview : 'ì¤„ê±°ë¦¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.'}"></p>
            </div>

            <!-- ğŸ­ ì¶œì—°ì§„ -->
            <div class="overview-wrapper mt-4">
                <h5 class="mb-2">ì¶œì—°ì§„</h5>
                <p class="d-flex flex-wrap" style="gap: 0.5rem;">
    <span th:each="actor, stat : ${#lists.size(detail.cast) > 5 ? detail.cast.subList(0,5) : detail.cast}"
          style="white-space: nowrap;">
        <span th:text="${actor.name + '(' + actor.character + 'ì—­)' + (!stat.last ? ',' : '')}"></span>
        <span th:if="${stat.last}"> ë“±</span>
    </span>
                </p>
            </div>
        </div>
    </div>

    <!-- ğŸ”˜ ë²„íŠ¼ ì˜ì—­ -->
    <div class="container button-group-container">
        <div class="row">
            <div class="col-md-6 d-flex justify-content-start">
                <th:block th:if="${from == 'search'}">
                    <a th:href="@{/movies/search(keyword=${keyword}, category=${category}, page=${page})}"
                       class="btn btn-secondary">ğŸ” ê²€ìƒ‰ ê²°ê³¼ë¡œ ëŒì•„ê°€ê¸°</a>
                </th:block>

                <th:block th:if="${from == 'list'}">
                    <a th:href="@{/movies(page=${page})}" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
                </th:block>

                <th:block th:if="${from == null}">
                    <a th:href="@{/movies}" class="btn btn-secondary">â¬… ëª©ë¡ìœ¼ë¡œ</a>
                </th:block>
            </div>

            <div class="col-md-6 d-flex justify-content-end gap-3">
                <a th:if="${detail != null}"
                   th:href="@{/reviews/new(movieId=${movie != null ? movie.movieId : detail.tmdbId})}"
                   class="btn btn-primary">ë¦¬ë·° ì‘ì„±í•˜ê¸°</a>

                <a th:href="@{/reviews/search(keyword=${movie != null ? movie.title : detail.title})}"
                   class="btn btn-outline-primary">ë¦¬ë·° ë³´ê¸°</a>
            </div>
        </div>
    </div>

</div>

</body>
</html>
