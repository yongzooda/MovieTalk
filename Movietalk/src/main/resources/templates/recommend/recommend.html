<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì˜í™” ì¶”ì²œ | MovieTalk</title>

    <style>
        /* === ì „ì—­ === */
        body{
            margin:0;
            padding:80px 0 0;                    /* ë„¤ë¹„ ì—¬ìœ  */
            display:flex;flex-direction:column;min-height:100vh;
            background:#141414;color:#fff;
            font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;
        }
        h2{margin:40px 0 20px;text-align:center;font-size:2.2em;}

        /* === ì¹´ë“œ ê·¸ë¦¬ë“œ === */
        #grid{
            display:grid;grid-template-columns:repeat(7,1fr);gap:16px;
            padding:0 40px;
            padding-bottom:140px;                /* í•˜ë‹¨ ê³ ì • ë²„íŠ¼ ì—¬ë°± */
            flex:1 0 auto;
        }
        .card{position:relative;cursor:pointer;transition:transform .2s;}
        .card img{width:100%;border-radius:4px;}
        .card:hover{transform:scale(1.05);}
        .overlay{
            position:absolute;top:0;left:0;width:100%;height:100%;
            background:rgba(20,20,20,.35);border-radius:4px;
            display:flex;align-items:center;justify-content:center;
            opacity:0;transition:opacity .2s;font-size:1.1em;
        }
        .card:hover .overlay{opacity:1;}

        /* === í•˜ë‹¨ ê³ ì • ë²„íŠ¼ === */
        .btn-wrapper{
            position:sticky;bottom:20px;         /* í‘¸í„° ë‹¿ìœ¼ë©´ ìœ„ë¡œ ë°€ë¦¼ */
            display:flex;justify-content:center;
            z-index:1000;
        }
        #addFavoriteButton{
            padding:10px 24px;
            background:#e50914;color:#fff;border:none;border-radius:4px;
            font-size:1em;cursor:pointer;
        }
    </style>
</head>
<body>

<!-- ìƒë‹¨ ë„¤ë¹„ -->
<div th:replace="~{fragments/top-nav :: topNav}"></div>

<h2>ğŸ¬ ì¶”ì²œ ì˜í™”</h2>

<!-- ì¹´ë“œ ê·¸ë¦¬ë“œ -->
<div id="grid"></div>

<!-- í•˜ë‹¨ ê³ ì • ë²„íŠ¼ -->
<div class="btn-wrapper">
    <button id="addFavoriteButton">ì„ í˜¸ì˜í™” ì¶”ê°€í•˜ê¸°</button>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    const user_id = [[${user_id}]];
    const grid    = document.getElementById('grid');
    const IMG     = 'https://image.tmdb.org/t/p/w300';

    /* ì˜¨ë³´ë”© ì´ë™ ë²„íŠ¼ */
    document.getElementById('addFavoriteButton')
        .addEventListener('click', () => location.href = '/onboarding');

    /* ì¦ê²¨ì°¾ê¸° ê°œìˆ˜ ì²´í¬ â†’ ë¶€ì¡±í•˜ë©´ ì˜¨ë³´ë”©ìœ¼ë¡œ */
    fetch(`/api/recommendations/check/${user_id}`)
        .then(r => r.json())
        .then(({ has_favorite }) => {
            if (!has_favorite){
                location.href = '/onboarding';
                throw 'onboarding';
            }
            /* ì‹¤ì œ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ */
            return fetch(`/api/recommendations/${user_id}`);
        })
        .then(r => r.json())
        .then(list => {
            if (!list || list.length === 0){
                grid.innerHTML = '<p style="color:#aaa;">ì¶”ì²œí•  ì˜í™”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            list.forEach(m => {
                const card = document.createElement('div');
                card.className = 'card';
                card.onclick   = () => location.href = `/movies/${m.movie_id}`;
                card.innerHTML = `
        <img src="${IMG}${m.poster_path}" alt="${m.title}">
        <div class="overlay">ìƒì„¸ ë³´ê¸°</div>
      `;
                grid.appendChild(card);
            });
        })
        .catch(e => {
            if (e !== 'onboarding')
                grid.innerHTML = '<p style="color:#aaa;">ì¶”ì²œ í˜¸ì¶œ ì‹¤íŒ¨: '+e+'</p>';
        });
    /*]]>*/
</script>

<!-- í•˜ë‹¨ í‘¸í„° -->
<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
