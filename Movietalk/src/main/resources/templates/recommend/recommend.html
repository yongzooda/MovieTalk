<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì˜í™” ì¶”ì²œ</title>
    <style>
        .card{width:160px;margin:10px;padding:12px;border:1px solid #ddd;border-radius:12px;text-align:center;}
        .card img{width:100%;border-radius:8px;}
    </style>
</head>
<body>
<!-- ìƒë‹¨ ë„¤ë¹„ -->
<div th:replace="fragments/top-nav :: topNav"></div>

<h2 style="margin:24px;">ğŸ¬ ì¶”ì²œ ì˜í™”</h2>
<div id="box" style="display:flex;flex-wrap:wrap;gap:20px;margin:24px;"></div>

<script th:inline="javascript">
    /*<![CDATA[*/
    const user_id = [[${user_id}]];
    const box = document.getElementById('box');

    // ì¦ê²¨ì°¾ê¸° ê°œìˆ˜ ì²´í¬ â†’ ì¶”ì²œ or ì˜¨ë³´ë”© ë¶„ê¸°
    fetch(`/api/recommendations/check/${user_id}`)
        .then(r => r.json())
        .then(({has_favorite}) => {
            if(!has_favorite){
                location.href = '/onboarding';
                return;
            }
            // ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ í˜¸ì¶œ
            fetch(`/api/recommendations/${user_id}`)
                .then(r => r.json())
                .then(list => {
                    if(list.length===0){
                        box.innerHTML = '<p>ì¶”ì²œí•  ì˜í™”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                        return;
                    }
                    list.forEach(m => {
                        const div = document.createElement('div');
                        div.className = 'card';
                        div.innerHTML = `
                      <img src="${m.poster_path}" alt="${m.title}">
                      <p>${m.title}</p>
                    `;
                        box.appendChild(div);
                    });
                })
                .catch(e => box.innerHTML = '<p>ì¶”ì²œ í˜¸ì¶œ ì‹¤íŒ¨: '+e+'</p>');
        })
        .catch(e => box.innerHTML = '<p>ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: '+e+'</p>');
    /*]]>*/
</script>
</body>
</html>
