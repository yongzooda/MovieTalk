<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì˜í™” ì¶”ì²œ</title>

    <style>
        /* Netflixâ€‘like dark theme */
        body {
            margin: 0;
            padding: 0;
            background-color: #141414;
            color: #fff;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }
        h2 {
            text-align: center;
            margin: 40px 0 20px;
            font-size: 2.2em;
        }

        /* ì¹´ë“œ 1ì¤„ 7ê°œ ê·¸ë¦¬ë“œ */
        #grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 16px;
            padding: 0 40px 60px;
        }
        .card {
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .card img {
            width: 100%;
            border-radius: 4px;
        }
        .card:hover {
            transform: scale(1.05);
        }
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(20, 20, 20, 0.35);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 1.1em;
        }
        .card:hover .overlay {
            opacity: 1;
        }
    </style>
</head>
<body>

<!-- ìƒë‹¨ ë„¤ë¹„ -->
<div th:replace="fragments/top-nav :: topNav"></div>

<h2>ğŸ¬ ì¶”ì²œ ì˜í™”</h2>
<div id="grid"></div>

<script th:inline="javascript">
    /*<![CDATA[*/
    const user_id = [[${user_id}]];
    const grid    = document.getElementById('grid');
    const IMG     = 'https://image.tmdb.org/t/p/w300';

    // ì¦ê²¨ì°¾ê¸° ìˆ˜ê°€ ë¶€ì¡±í•˜ë©´ ì˜¨ë³´ë”©ìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜
    fetch(`/api/recommendations/check/${user_id}`)
        .then(r => r.json())
        .then(({ has_favorite }) => {
            if (!has_favorite) {
                location.href = '/onboarding';
                return Promise.reject('onboarding');
            }
            return fetch(`/api/recommendations/${user_id}`);
        })
        .then(r => r.json())
        .then(list => {
            if (!list || list.length === 0) {
                grid.innerHTML = '<p style="color:#aaa;">ì¶”ì²œí•  ì˜í™”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.forEach(m => {
                const card = document.createElement('div');
                card.className = 'card';
                card.onclick   = () => location.href = `/movies/${m.movie_id}`; // snake_case ê·¸ëŒ€ë¡œ

                card.innerHTML = `
            <img src="${IMG}${m.poster_path}" alt="${m.title}">
            <div class="overlay">ìƒì„¸ ë³´ê¸°</div>
          `;
                grid.appendChild(card);
            });
        })
        .catch(e => {
            if (e !== 'onboarding') {
                grid.innerHTML = '<p style="color:#aaa;">ì¶”ì²œ í˜¸ì¶œ ì‹¤íŒ¨: ' + e + '</p>';
            }
        });
    /*]]>*/
</script>
</body>
</html>
