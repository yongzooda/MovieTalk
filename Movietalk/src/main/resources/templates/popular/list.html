<!-- src/main/resources/templates/popular/list.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>인기 영화 TOP</title>

    <!-- 1) 스타일 추가 -->
    <style>

        /* 페이지 네비게이션용 컨트롤 */
  .pagination-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1rem;
  }
  .pagination-controls button,
  .pagination-controls input[type="number"] {
    font-size: 1.1rem;
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
  .pagination-controls button {
    background-color: #007bff;
    color: #fff;
    border: none;
    cursor: pointer;
  }
  .pagination-controls button:hover {
    background-color: #0056b3;
  }
  .pagination-controls input[type="number"] {
    width: 3rem;
    text-align: center;
  }

        /* 필터 폼 감싸는 영역 */
        .filter-controls {
          margin-bottom: 1rem;
        }

        /* 셀렉트 박스 공통 스타일 */
        .filter-controls select {
          font-size: 1.1rem;       /* 폰트 크기 키우기 */
          padding: 0.4rem 0.8rem;  /* 세로·가로 패딩 추가 */
          margin-right: 0.5rem;    /* 요소 간 간격 */
        }

        /* 버튼 공통 스타일 */
        .filter-controls button {
          font-size: 1.1rem;
          padding: 0.45rem 1rem;
          cursor: pointer;
          background-color: #007bff;
          border: none;
          color: white;
          border-radius: 4px;
        }

        .filter-controls button:hover {
          background-color: #0056b3;
        }
    </style>
</head>
<body
        th:with="
        currentPeriod=${param.period != null ? param.period[0] : 'DAILY'},
        currentSort=${param.sort   != null ? param.sort[0]   : 'VIEWS'}">

<div th:replace="~{fragments/top-nav :: topNav}"></div>

<h1 th:text="${currentSort=='REVIEWS'}
                  ? '인기 영화 TOP - 리뷰수'
                  : '인기 영화 TOP - 조회수'">
    인기 영화 TOP
</h1>

<form method="get" th:action="@{/popular}" class="filter-controls">
    <select name="period">
        <option value="DAILY"   th:selected="${currentPeriod=='DAILY'}">일간</option>
        <option value="WEEKLY"  th:selected="${currentPeriod=='WEEKLY'}">주간</option>
        <option value="MONTHLY" th:selected="${currentPeriod=='MONTHLY'}">월간</option>
        <option value="ALLTIME" th:selected="${currentPeriod=='ALLTIME'}">전체</option>
    </select>

    <select name="sort">
        <option value="VIEWS"   th:selected="${currentSort=='VIEWS'}">조회수</option>
        <option value="REVIEWS" th:selected="${currentSort=='REVIEWS'}">리뷰수</option>
    </select>

    <button type="submit">적용</button>
</form>
<hr/>

<table border="1" cellpadding="6" cellspacing="0">
    <thead>
    <tr>
        <th>순위</th>
        <th>포스터</th>
        <th>제목</th>
        <th>개봉일</th>
        <th th:text="${currentSort=='REVIEWS'} ? '리뷰수' : '조회수'">메트릭</th>
        <th>배우</th>
        <th>해당 영화 관련</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="card : ${resp.content}">
        <td th:text="${card.rank}">1</td>
        <td>
            <img th:src="@{|https://image.tmdb.org/t/p/w100${card.posterUrl}|}"
                 alt="poster" width="50"/>
        </td>
        <td th:text="${card.title}">Movie Title</td>
        <td th:text="${#temporals.format(card.releaseDate,'yyyy-MM-dd')}">
            2021-01-01
        </td>
        <td th:text="${card.metricLabel} + ' : ' + ${card.metricValue}">
            조회수 : 150
        </td>
        <td>
          <span th:each="chip,iterStat : ${card.actorChips}">
            <a th:href="@{/actors/{id}(id=${chip.actorId})}"
               th:text="${chip.name}">배우이름</a>
            <span th:if="${!iterStat.last}">, </span>
          </span>
        </td>
        <td>
            <button type="button">리뷰 보러가기</button>
            <button type="button"
                    th:onclick="|location.href='@{/movies/{id}(id=${card.movieId})}'|">
                상세보기
            </button>
        </td>
    </tr>
    </tbody>
</table>

<!-- 페이징 -->

<form method="get" th:action="@{/popular}" class="pagination-controls">
    <!-- 기존 파라미터 유지 -->
    <input type="hidden" name="size"   th:value="${resp.meta.size}" />
    <input type="hidden" name="period" th:value="${currentPeriod}" />
    <input type="hidden" name="sort"   th:value="${currentSort}" />

    <!-- Prev 버튼 -->
    <button type="submit"
            name="page"
            th:value="${resp.meta.page-1}"
            th:if="${resp.meta.page>0}">
        &laquo; Prev
    </button>

    <!-- 직접 입력 가능한 페이지 넘버 -->
    <input type="number"
           name="page"
           min="1"
           th:attr="max=${resp.meta.totalPages}"
           th:value="${resp.meta.page+1}" />

    <!-- 총 페이지 수 표시 -->
    <span>/ <span th:text="${resp.meta.totalPages}">3</span></span>

    <!-- 입력 후 바로 이동 -->
    <button type="submit">Go</button>

    <!-- Next 버튼 -->
    <button type="submit"
            name="page"
            th:value="${resp.meta.page+1}"
            th:if="${resp.meta.page+1 < resp.meta.totalPages}">
        Next &raquo;
    </button>
</form>
</body>
</html>