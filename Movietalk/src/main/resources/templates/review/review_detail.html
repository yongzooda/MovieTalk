<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ë¦¬ë·° ìƒì„¸ | MovieTalk</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background-color: #f7f9f9; margin: 0; padding: 2rem; }
    .container { max-width: 900px; margin: auto; }
    .movie-info { display: flex; align-items: flex-start; background-color: white; padding: 1rem; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 1.5rem; }
    .poster { width: 150px; height: auto; border-radius: 8px; margin-right: 1rem; display: none; }
    .movie-meta h2 { margin: 0 0 0.5rem; color: #2f855a; }
    .movie-meta p { margin: 0.2rem 0; color: #4a5568; }
    .review-content { background-color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .review-actions { display: flex; gap: 1rem; margin-top: 1rem; }
    .review-actions form { display: flex; align-items: center; gap: 0.3rem; margin: 0; }
    .action-btn { background-color: #68d391; border: none; padding: 0.5rem 1rem; border-radius: 6px; color: white; cursor: pointer; }
    .action-btn:hover { background-color: #48bb78; }
    .like-count { color: #22543d; font-weight: bold; font-size: 1rem; min-width: 24px; text-align: left; }
    .dislike-count { color: #c53030; font-weight: bold; font-size: 1rem; min-width: 24px; text-align: left; }
    .comment-section { background-color: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .comment { border-bottom: 1px solid #e2e8f0; padding: 0.8rem 0; }
    .comment:last-child { border-bottom: none; }
    .comment-form { display: flex; margin-top: 1rem; gap: 0.5rem; }
    .comment-form textarea { flex-grow: 1; padding: 0.5rem; border-radius: 6px; border: 1px solid #cbd5e0; resize: none; }
    .comment-form button { background-color: #38a169; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; }
    .comment-form button:hover { background-color: #2f855a; }
    .action-btn.active { box-shadow: 0 0 0 2px #22543d77; }
    .action-btn.dislike.active { box-shadow: 0 0 0 2px #c5303077; }
  </style>
</head>
<body>
<div class="container">
  <!-- ì˜í™” ì •ë³´ (í¬ìŠ¤í„°, ì˜í™” ì œëª© ëŒ€ì‹  ì˜í™”IDë¡œ í‘œì‹œ) -->
  <div class="movie-info">
    <!-- <img th:src="${review.moviePosterUrl}" alt="í¬ìŠ¤í„°" class="poster" /> -->
    <div class="movie-meta">
      <h2 th:text="'ì˜í™” ID: ' + ${review.movieId}">ì˜í™” ID</h2>
      <p th:text="'ì‘ì„±ì: ' + ${review.user.nickname}">ì‘ì„±ì</p>
      <p th:text="'ì‘ì„±ì¼: ' + ${#temporals.format(review.createdAt, 'yyyy-MM-dd HH:mm')}">ì‘ì„±ì¼</p>
    </div>
  </div>

  <!-- ë¦¬ë·° ë‚´ìš© -->
  <div class="review-content" th:text="${review.content}">ë¦¬ë·° ë³¸ë¬¸</div>

  <!-- ì¢‹ì•„ìš” / ì‹«ì–´ìš” (ë²„íŠ¼ë§Œ, myReaction í•„ë“œ ì—†ìŒì— ìœ ì˜!) -->
  <div class="review-actions">
    <button id="like-btn" class="action-btn">
      ğŸ‘ ì¢‹ì•„ìš”
    </button>
    <span class="like-count" id="like-count" th:text="${review.likeCount}">0</span>

    <button id="dislike-btn" class="action-btn dislike">
      ğŸ‘ ì‹«ì–´ìš”
    </button>
    <span class="dislike-count" id="dislike-count" th:text="${review.dislikeCount}">0</span>

    <!-- ì‹ ê³  ë²„íŠ¼ì€ ê¸°ì¡´ ê·¸ëŒ€ë¡œ (POST form ë°©ì‹) -->
    <form th:action="@{'/reviews/' + ${review.id} + '/report'}" method="post">
      <button class="action-btn" type="submit">ğŸš¨ ì‹ ê³ </button>
    </form>
  </div>

  <!-- ëŒ“ê¸€ ì„¹ì…˜ (ì•„ì§ ì‹¤ì œ ëŒ“ê¸€ ê¸°ëŠ¥ Xë¼ë©´, ì•ˆì „í•˜ê²Œ ì£¼ì„ ì²˜ë¦¬ ê°€ëŠ¥) -->
  <!--
  <div class="comment-section">
    <h3>ëŒ“ê¸€</h3>
    <div th:each="comment : ${commentList}" class="comment">
      <p><strong th:text="${comment.author}">ì‘ì„±ì</strong></p>
      <p th:text="${comment.content}">ëŒ“ê¸€ ë‚´ìš©</p>
      <p th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}">ì‘ì„±ì¼</p>
    </div>
    <form class="comment-form" th:action="@{'/reviews/' + ${review.id} + '/comment'}" method="post">
      <textarea name="content" rows="2" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
      <button type="submit">ë“±ë¡</button>
    </form>
  </div>
  -->
</div>
<!-- ì—¬ê¸°ë¶€í„° JS ìˆ˜ì •! -->
<script th:inline="javascript">
  const reviewId = [[${review.id}]];
  console.log("reviewId=", reviewId);

  document.addEventListener('DOMContentLoaded', function() {
    function sendReaction(reactionType) {
      fetch(`/review/${reviewId}/reaction`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ reaction: reactionType.toLowerCase() }) // "like" or "dislike"
      })
      .then(response => response.json())
      .then(data => {
        document.getElementById('like-count').innerText = data.likeCount;
        document.getElementById('dislike-count').innerText = data.dislikeCount;
      });
    }

    document.getElementById('like-btn').addEventListener('click', function() {
      sendReaction("LIKE");
    });
    document.getElementById('dislike-btn').addEventListener('click', function() {
      sendReaction("DISLIKE");
    });
  });
</script>
</body>
</html>





