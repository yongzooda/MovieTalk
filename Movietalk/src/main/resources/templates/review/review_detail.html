<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>리뷰 상세 | MovieTalk</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background-color: #f7f9f9; margin: 0; padding: 2rem; }
    .container { max-width: 900px; margin: auto; }
    .movie-info { display: flex; align-items: flex-start; background-color: white; padding: 1rem; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 1.5rem; }
    .poster { width: 150px; height: auto; border-radius: 8px; margin-right: 1rem; display: none; }
    .movie-meta h2 { margin: 0 0 0.5rem; color: #2f855a; }
    .movie-meta p { margin: 0.2rem 0; color: #4a5568; }
    .review-content { background-color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .review-actions { display: flex; gap: 1rem; margin-top: 1rem; }
    .review-actions form { display: flex; align-items: center; gap: 0.3rem; margin: 0; }
    .action-btn { background-color: #68d391; border: none; padding: 0.5rem 1rem; border-radius: 6px; color: white; cursor: pointer; }
    .action-btn:hover { background-color: #48bb78; }
    .like-count { color: #22543d; font-weight: bold; font-size: 1rem; min-width: 24px; text-align: left; }
    .dislike-count { color: #c53030; font-weight: bold; font-size: 1rem; min-width: 24px; text-align: left; }
    .comment-section { background-color: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .comment { border-bottom: 1px solid #e2e8f0; padding: 0.8rem 0; }
    .comment:last-child { border-bottom: none; }
    .comment-form { display: flex; margin-top: 1rem; gap: 0.5rem; }
    .comment-form textarea { flex-grow: 1; padding: 0.5rem; border-radius: 6px; border: 1px solid #cbd5e0; resize: none; }
    .comment-form button { background-color: #38a169; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; }
    .comment-form button:hover { background-color: #2f855a; }
    .action-btn.active { box-shadow: 0 0 0 2px #22543d77; }
    .action-btn.dislike.active { box-shadow: 0 0 0 2px #c5303077; }
  </style>
</head>
<body>
<div class="container">
  <!-- 영화 정보 (포스터, 영화 제목 대신 영화ID로 표시) -->
  <div class="movie-info">
    <!-- <img th:src="${review.moviePosterUrl}" alt="포스터" class="poster" /> -->
    <div class="movie-meta">
      <h2 th:text="'영화 ID: ' + ${review.movieId}">영화 ID</h2>
      <p th:text="'작성자: ' + ${review.user.nickname}">작성자</p>
      <p th:text="'작성일: ' + ${#temporals.format(review.createdAt, 'yyyy-MM-dd HH:mm')}">작성일</p>
    </div>
  </div>

  <!-- 리뷰 내용 -->
  <div class="review-content" th:text="${review.content}">리뷰 본문</div>

  <!-- 좋아요 / 싫어요 (버튼만, myReaction 필드 없음에 유의!) -->
  <div class="review-actions">
    <button id="like-btn" class="action-btn">
      👍 좋아요
    </button>
    <span class="like-count" id="like-count" th:text="${review.likeCount}">0</span>

    <button id="dislike-btn" class="action-btn dislike">
      👎 싫어요
    </button>
    <span class="dislike-count" id="dislike-count" th:text="${review.dislikeCount}">0</span>

    <!-- 신고 버튼은 기존 그대로 (POST form 방식) -->
    <form th:action="@{'/reviews/' + ${review.id} + '/report'}" method="post">
      <button class="action-btn" type="submit">🚨 신고</button>
    </form>
  </div>

  <!-- 댓글 섹션 (아직 실제 댓글 기능 X라면, 안전하게 주석 처리 가능) -->
  <!--
  <div class="comment-section">
    <h3>댓글</h3>
    <div th:each="comment : ${commentList}" class="comment">
      <p><strong th:text="${comment.author}">작성자</strong></p>
      <p th:text="${comment.content}">댓글 내용</p>
      <p th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}">작성일</p>
    </div>
    <form class="comment-form" th:action="@{'/reviews/' + ${review.id} + '/comment'}" method="post">
      <textarea name="content" rows="2" placeholder="댓글을 입력하세요..."></textarea>
      <button type="submit">등록</button>
    </form>
  </div>
  -->
</div>
<!-- 여기부터 JS 수정! -->
<script th:inline="javascript">
  const reviewId = [[${review.id}]];
  console.log("reviewId=", reviewId);

  document.addEventListener('DOMContentLoaded', function() {
    function sendReaction(reactionType) {
      fetch(`/review/${reviewId}/reaction`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ reaction: reactionType.toLowerCase() }) // "like" or "dislike"
      })
      .then(response => response.json())
      .then(data => {
        document.getElementById('like-count').innerText = data.likeCount;
        document.getElementById('dislike-count').innerText = data.dislikeCount;
      });
    }

    document.getElementById('like-btn').addEventListener('click', function() {
      sendReaction("LIKE");
    });
    document.getElementById('dislike-btn').addEventListener('click', function() {
      sendReaction("DISLIKE");
    });
  });
</script>
</body>
</html>





